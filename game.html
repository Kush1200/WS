<!DOCTYPE html>
<html>
<head>
    <title>The Meka Game - Dude Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #fce7f3; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; font-family: 'Courier New', Courier, monospace; }
        #game-container { border: 8px solid #ff85a2; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); position: relative; }
        .ui-box { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 80%; background: white; border: 4px solid #ff85a2; padding: 15px; border-radius: 10px; display: none; z-index: 10; pointer-events: none;}
        
        .nav-pill { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); padding: 10px 25px; border-radius: 50px; border: 1px solid white; z-index: 100; text-decoration: none; color: #ff85a2; font-weight: bold; font-size: 14px; }
    </style>
</head>
<body>

    <a href="/home" class="nav-pill">üè† Home</a>

    <div id="game-container"></div>
    <div id="dialog-box" class="ui-box">
        <p id="dialog-text" style="margin:0; font-weight:bold; color:#444;"></p>
        <small style="color: #ff85a2; display:block; margin-top:5px;">Press SPACE to close...</small>
    </div>

    <script>
        const config = {
            type: Phaser.AUTO,
            width: 640,
            height: 480,
            parent: 'game-container',
            pixelArt: true, 
            physics: { 
                default: 'arcade', 
                arcade: { debug: false } 
            },
            scene: { preload: preload, create: create, update: update }
        };

        const game = new Phaser.Game(config);
        let player, cursors, spaceBar, isDialogActive = false;

        function preload() {
            // Updated to /dude.png for clean GitHub URLs
            // The frames in your image look to be roughly 32x32 based on the height
            this.load.spritesheet('meka', '/dude.png', { 
                frameWidth: 32, 
                frameHeight: 32 
            });
        }

        function create() {
            this.add.rectangle(320, 240, 640, 480, 0xfff1f2);

            player = this.physics.add.sprite(320, 240, 'meka');
            player.setScale(4); 
            player.setCollideWorldBounds(true);
            
            // Hitbox tuned for 32x32 sprites
            player.setBodySize(20, 12);
            player.setOffset(6, 20);

            // ANIMATIONS mapped to your dude.png frames
            this.anims.create({
                key: 'walk-side',
                frames: this.anims.generateFrameNumbers('meka', { start: 0, end: 3 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'walk-down',
                frames: this.anims.generateFrameNumbers('meka', { start: 5, end: 6 }),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'walk-up',
                frames: this.anims.generateFrameNumbers('meka', { start: 7, end: 8 }),
                frameRate: 8,
                repeat: -1
            });

            this.anims.create({
                key: 'idle',
                frames: [{ key: 'meka', frame: 4 }],
                frameRate: 1
            });

            cursors = this.input.keyboard.createCursorKeys();
            spaceBar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        }

        function update() {
            if (isDialogActive) {
                player.setVelocity(0);
                player.anims.stop();
                if (Phaser.Input.Keyboard.JustDown(spaceBar)) { closeDialog(); }
                return;
            }

            const walkSpeed = 160;
            player.setVelocity(0);

            if (cursors.left.isDown) {
                player.setVelocityX(-walkSpeed);
                player.setFlipX(true); // Mirrored for Left movement
                player.anims.play('walk-side', true);
            } else if (cursors.right.isDown) {
                player.setVelocityX(walkSpeed);
                player.setFlipX(false); // Normal for Right movement
                player.anims.play('walk-side', true);
            } else if (cursors.up.isDown) {
                player.setVelocityY(-walkSpeed);
                player.setFlipX(false);
                player.anims.play('walk-up', true);
            } else if (cursors.down.isDown) {
                player.setVelocityY(walkSpeed);
                player.setFlipX(false);
                player.anims.play('walk-down', true);
            } else {
                player.anims.play('idle');
            }
        }

        function closeDialog() {
            isDialogActive = false;
            document.getElementById('dialog-box').style.display = 'none';
        }
    </script>
</body>
</html>